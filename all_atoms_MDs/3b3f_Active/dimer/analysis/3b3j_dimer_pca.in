parm ../tleap/solvated_3b3j_dimer.parm7
trajin ../mdrun/3b3j_dimer_md400.mdcrd 1 last 10
unwrap :1-652    # Unwrap periodic boundary conditions (if required)
center origin :1-652
autoimage
strip :WAT,Na+,Cl-

rms first @N,C,CA
average @N,C,CA crdset trajaverage3b3jDimer
createcrd trajectory3b3jDimer

run

#creating covariance matrix and projecting
crdaction trajectory3b3jDimer rms ref trajaverage3b3jDimer @N,C,CA
crdaction trajectory3b3jDimer matrix covar name covmatrix3b3jDimer @N,C,CA
runanalysis diagmatrix covmatrix3b3jDimer out evecs3b3jDimer.dat vecs 10 name eigenvectors3b3jDimer nmwiz nmwizvecs 10 nmwizfile normalmodes3b3jDimer.nmd nmwizmask @N,C,CA
crdaction trajectory3b3jDimer projection modes eigenvectors3b3jDimer beg 1 end 10 @N,C,CA out pca3b3jDimer.dat crdframes 1,last

clear all
readdata evecs3b3jDimer.dat name eigenvectors3b3jDimer
parm stripped_3b3j_dimer.parm7
parmwrite out 3b3jDimer.prmtop
runanalysis modes name eigenvectors3b3jDimer trajout modes3b3jDimer.dcd pcmin -150 pcmax 150 tmode 1 trajoutmask @N,C,CA trajoutfmt dcd
#the 3b3jDimer.prmtop can be read in a visualization software to ‘see’ the motions that correspond to each primary component

run

###################################################################################################################################